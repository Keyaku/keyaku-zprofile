The contents of this document were generated by Claude (Sonnet 4.5).

This does not mean that all this will be followed to the letter. Plenty of this stuff is not reflective of my ideas.
However, it serves as a good series of pointers.

## Current Structure Analysis

Current setup has:

* `.zshenv`, `.zprofile`, `.zshrc`, `.zlogin` at `$ZDOTDIR/`
* `.zfunc/` - custom functions
* `profile.d/` - various .zsh scripts
* `extensions/` - plugins (avoiding ohmyzsh's `_omz_source` overhead)
* `ohmyzsh/` as submodule (loaded in `.zshrc`)
* `powerlevel10k/` as submodule

## Proposed Restructured Directory Layout

```
$ZDOTDIR/
├── .zshenv                   # Entry point - sources env/ content
├── .zprofile                 # Entry point - sources profile/ content
├── .zshrc                    # Entry point - sources rc/ content, loads omz
├── .zlogin                   # Entry point - sources login/ content
├── .zlogout                  # Entry point (if needed)
│
├── env/                      # Stage 1: .zshenv content
│   ├── 00-core.zsh           # Core utilities
│   ├── 10-paths.zsh          # PATH manipulation setup
│   ├── 20-xdg.zsh            # XDG base directory setup
│   └── 30-environment.zsh    # Other environment variables
│
├── profile/                  # Stage 2: .zprofile content
│   ├── 00-functions.zsh      # Session-wide functions (addpath, rmpath, etc.)
│   ├── 10-detection.zsh      # OS/environment detection
│   └── 20-session-env.zsh    # Session-specific environment
│
├── rc/                       # Stage 3: .zshrc content
│   ├── 00-pre-omz.zsh        # Anything needed before omz loads
│   ├── 10-omz-config.zsh     # OMZ configuration (ZSH_THEME, plugins list, etc.)
│   ├── 20-omz-load.zsh       # Load ohmyzsh here
│   ├── 30-post-omz.zsh       # Post-omz setup
│   ├── 40-functions.zsh      # Interactive shell functions
│   ├── 50-aliases.zsh        # Aliases
│   ├── 60-keybindings.zsh    # Key bindings
│   └── 70-extensions.zsh     # Load extensions
│
├── login/                    # Stage 4: .zlogin content
│   └── 00-autostart.zsh      # Command-line utilities autostart
│
├── lib/                      # Shared library of functions
│   ├── core/                 # Core functions used everywhere
│   │   ├── command-has.zsh
│   │   ├── get_funcname.zsh
│   │   ├── print_fn.zsh
│   │   └── ...
│   ├── env/                  # Environment utilities
│   └── interactive/          # Interactive-only utilities
│
├── extensions/               # Your plugins (loaded natively)
│   ├── my-git/
│   │   └── my-git.plugin.zsh
│   ├── my-docker/
│   │   └── my-docker.ext.zsh
│   └── ...
│
├── vendor/                   # External dependencies
│   ├── ohmyzsh/              # git submodule
│   └── powerlevel10k/        # git submodule
│
└── conf/
    ├── first_setup.zsh
    └── ...
```

## Key Design Decisions

### 1. Stage-based directories (`env/`, `profile/`, `rc/`, `login/`)

Each directory corresponds to a ZSH startup stage. Files are numbered (00-, 10-, 20-) to control load order within each stage.

### 2. Shared `lib/` directory

This solves the dependency problem elegantly:
* Core functions go in `lib/core/` and are sourced early (from `.zshenv`)
* Path functions go in `lib/path/` and are sourced in `.zprofile`
* Functions can be categorized by purpose
* Both stage-specific files AND extensions can depend on these

### 3. Extensions remain separate from ohmyzsh

* Keep in `extensions/` directory
* Load them in `rc/70-extensions.zsh` using native source (fast)
* They can still follow ohmyzsh's plugin structure for compatibility
* No `_omz_source` overhead

### 4. Vendor directory for submodules

Cleaner separation of external code from custom code.


## Implementation Strategy

### Main Entry Point Files

`.zshenv`:
```zsh
# Source core functions first (needed everywhere)
for file in ${ZDOTDIR}/lib/core/*.zsh(N); do
    source "$file"
done

# Source environment stage
for file in ${ZDOTDIR}/env/*.zsh(N.); do
    source "$file"
done
```

`.zprofile`:
```zsh
# Source path/session functions
for file in ${ZDOTDIR}/lib/path/*.zsh(N); do
    source "$file"
done

for file in ${ZDOTDIR}/lib/env/*.zsh(N); do
    source "$file"
done

# Source profile stage
for file in ${ZDOTDIR}/profile/*.zsh(N.); do
    source "$file"
done
```

`.zshrc`:
```zsh
# Source interactive lib functions
for file in ${ZDOTDIR}/lib/interactive/*.zsh(N); do
    source "$file"
done

# Source rc stage (includes omz loading)
for file in ${ZDOTDIR}/rc/*.zsh(N.); do
    source "$file"
done
```

`.zlogin`:
```zsh
for file in ${ZDOTDIR}/login/*.zsh(N.); do
    source "$file"
done
```

### Extensions Loading (`rc/70-extensions.zsh`)

```zsh
# Load extensions natively (fast, no _omz_source overhead)
# Still compatible with omz plugin structure
for ext_dir in ${ZDOTDIR}/extensions/*(N/); do
    # Look for .plugin.zsh or .ext.zsh
    for plugin_file in ${ext_dir}/*.{plugin,ext}.zsh(N); do
        source "$plugin_file"
    done
done
```
